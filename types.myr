use std
use bio

pkg xml =
	type eventiter = ctx

	type ctx = struct
		file	:	bio.file#
		owned	:	bool
		p	:	parser#
	;;

	type parser = struct
		buf	:	byte[:]
		bidx	:	std.size
		bcur	:	std.size
		line	:	std.size
		off	:	std.size
		state	:	state
		more	:	bool
	;;

	type event = union
		`Instruction	(byte[:], byte[:])
		`Doctype	byte[:]
		`Eof
		`Start		(byte[:], (byte[:], byte[:])[:])
		`End		byte[:]
		`Characters	byte[:]
		`Cdata		byte[:]
		`Comment	byte[:]
	;;

	type mkerr = union
		`Efile		byte[:]
		`Eenc		byte[:]
	;;

	type err = struct
		line	:	std.size
		off	:	std.size
		err	:	errtype
	;;

	type errtype = union
		`Empty
		`Inval		char
		`Trunc		bio.err
		`Unclosed	(byte[:], byte[:])
		`Unexpected	(char, char)
	;;

	type state = union
		`Open
		`Close
		`Closing	byte[:]
	;;
;;

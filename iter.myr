use std

use "xml"
use "types"

pkg xml =
	impl iterable eventiter -> std.result(event, err)

	const byevent	:	(x : ctx# -> eventiter)
;;

impl iterable eventiter -> std.result(event, err) =
	__iternext__ = {iterp, valp
		if !iterp.p.more
			-> false
		;;

		valp# = dispatch((iterp : ctx#))
		-> true
	}

	__iterfin__ = {iterp, valp
		match valp#
		| `std.Ok e:	eventfree(e)
		| `std.Err e:
		;;
	}
;;

const byevent = {x
	-> (x# : eventiter)
}
